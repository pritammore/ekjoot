var map,appMap,geocoder;!function(e){"use strict";function a(e){var a=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return null==a?null:a[1]||0}function s(e){return e.split("?")[0]}function i(){var a=e("#nameSign").val(),s=e("#emailSign").val(),i=Math.floor(1e3*Math.random()+1),t=s.split("@",1);t=t[0]+i;var o=e("#passSign").val(),c=e("#addressSign").val(),l=e("#citySign").val(),r=e("#stateSign").val(),d=e("#neighborhoodSign").val(),v=e("#countrySign").val(),m=e("#latSign").val(),u=e("#lngSign").val(),p=e("#securitySignup").val(),_=services_vars.admin_url+"admin-ajax.php";e(".submitSign").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:_,data:{action:"conikal_user_signup_form",signup_user:t,signup_name:a,signup_email:s,signup_pass:o,signup_repass:o,signup_address:c,signup_city:l,signup_state:r,signup_neighborhood:d,signup_country:v,signup_lat:m,signup_lng:u,security:p},success:function(a){if(e(".submitSign").removeClass("loading disabled"),a.signedup===!0){var s='<div class="ui success message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>";e("#usernameSignin").val(t),e("#passwordSignin").val(o),e("#signSignin").val("true"),e("#signMessage").empty().append(s),n()}else{var s='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+a.message+"</div>";e("#signMessage").empty().append(s)}},error:function(e){}})}function t(){var a=e("#nameSignup").val(),s=e("#emailSignup").val(),i=Math.floor(1e3*Math.random()+1),t=s.split("@",2);t=t[0]+i;var o=e("#passSignup").val(),c=e("#repassSignup").val(),l=e("#addressSignup").val(),r=e("#citySignup").val(),d=e("#stateSign").val(),v=e("#neighborhoodSignup").val(),m=e("#countrySignup").val(),u=e("#latSignup").val(),p=e("#lngSignup").val(),_=e("#securitySignup").val(),g=services_vars.admin_url+"admin-ajax.php";e("#submitSignup").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:g,data:{action:"conikal_user_signup_form",signup_user:t,signup_name:a,signup_email:s,signup_pass:o,signup_repass:c,signup_address:l,signup_city:r,signup_state:d,signup_neighborhood:v,signup_country:m,signup_lat:u,signup_lng:p,security:_},success:function(a){if(e("#submitSignup").removeClass("loading disabled"),a.signedup===!0){var s='<div class="ui success message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>";e("#usernameSignin").val(t),e("#passwordSignin").val(o),e("#signSignin").val("false"),e("#signinMessage").empty().append(s),n()}else{var s='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+a.message+"</div>";e("#signinMessage").empty().append(s)}},error:function(e){}})}function n(){var a=e("#usernameSignin").val(),s=e("#passwordSignin").val(),i=e("#securitySignin").val(),t=e("#rememberSignin").is(":checked"),n=e('input[name="_wp_http_referer"]').val(),o=e("#signSignin").val(),c=e("#sign-comment").val();if(e("#email-notice").hasClass("checked"))var l=!1;else var l=!0;var r=services_vars.admin_url+"admin-ajax.php";e("#submitSignin").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:r,data:{action:"conikal_user_signin_form",signin_user:a,signin_pass:s,remember:t,security:i,referent:n,signature:o,comment:c,notice:l,post_id:services_vars.post_id},success:function(a){if(e("#submitSignin").removeClass("loading disabled"),a.signedin===!0){var s='<div class="ui success message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>";e("#signinMessage").empty().append(s),document.location.href=a.referent}else{var s='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+a.message+"</div>";e("#signinMessage").empty().append(s)}},error:function(e){}})}function o(){var a=e("#emailForgot").val(),s=e("#postID").val(),i=e("#securityForgot").val(),t=services_vars.admin_url+"admin-ajax.php";e("#submitForgot").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:t,data:{action:"conikal_forgot_pass_form",forgot_email:a,"security-login":i,postid:s},success:function(a){if(e("#submitForgot").removeClass("loading disabled"),e("#emailForgot").val(""),a.sent===!0){var s='<div class="ui success message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>";e("#forgotMessage, #resetPassMessage").empty().append(s),e("#forgot-password").modal("hide"),e("#resetpass").modal("show"),e("#resetLogin").val(a.login)}else{var s='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+a.message+"</div>";e("#forgotMessage").empty().append(s)}},error:function(e){}})}function c(){var s=e("#resetPass_1").val(),i=e("#resetPass_2").val(),t=a("key")||e("#resetKey").val(),n=a("login")||e("#resetLogin").val(),o=e("#securityResetpass").val(),c=services_vars.admin_url+"admin-ajax.php";e("#submitResetPass").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:c,data:{action:"conikal_reset_pass_form",pass_1:s,pass_2:i,key:t,login:n,"security-reset":o},success:function(a){if(e("#submitResetPass").removeClass("loading disabled"),e("#resetPass_1").val(""),e("#resetPass_2").val(""),a.reset===!0){var s='<div class="ui success message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>";e("#resetpass").modal("hide"),e("#signin-modal").modal("show").on("shown.bs.modal",function(a){e("#signinMessage").empty().append(s)})}else{var s='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+a.message+"</div>";e("#resetPassMessage").empty().append(s)}},error:function(e){}})}function l(){FB.getLoginStatus(function(a){if("connected"===a.status){r(function(e){d(function(a){v(e,a)})})}else"not_authorized"===a.status?FB.login(function(a){if(a.authResponse){r(function(e){d(function(a){v(e,a)})})}else{e(".signinFBText").removeClass("loading disabled");var s='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+services_vars.fb_login_error+"</div>";e("#signinMessage").empty().append(s)}},{scope:"email, public_profile, publish_actions, user_birthday"}):FB.login(function(a){if(a.authResponse){r(function(e){d(function(a){v(e,a)})})}else{e(".signinFBText").removeClass("laoding disabled");var s='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+services_vars.fb_login_error+"</div>";e("#signinMessage").empty().append(s)}},{scope:"email, public_profile, publish_actions, user_birthday"})})}function r(e){FB.api("/me",{fields:"name, first_name, middle_name, last_name, email, birthday, gender, cover"},function(a){e(a)})}function d(e){FB.api("/me/picture?type=large",function(a){e(a.data.url),console.log(a)})}function v(a,s){var i=a.id,t=a.first_name;t=t.toLowerCase().replace(" ","")+i;var n="",o=e("#securitySignin").val(),c=services_vars.admin_url+"admin-ajax.php";console.log(a),e.ajax({type:"POST",dataType:"json",url:c,data:{action:"conikal_facebook_login",user_id:i,signin_user:t,full_name:a.name,first_name:a.first_name,last_name:a.last_name,email:a.email,birthday:a.birthday,gender:a.gender,cover:n,avatar:s,security:o},success:function(a){if(e(".signinFBText").removeClass("laoding disabled"),a.signedin===!0){var s='<div class="ui success message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>";e("#signinMessage").empty().append(s),document.location.href=services_vars.signin_redirect}else{var s='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+a.message+"</div>";e("#signinMessage").empty().append(s)}},error:function(e){}})}function m(a){if(a.status.signed_in)gapi.client.load("plus","v1",u);else{e("#googleSigninBtn").removeClass("disabled loading");var s='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+services_vars.google_signin_error+"</div>";e("#signinMessage").empty().append(s)}}function u(){gapi.client.plus.people.get({userId:"me"}).execute(p)}function p(a){var i=a.id,t=a.name.givenName;t=t.toLowerCase().replace(" ","")+i;for(var n,o=a.displayName,c=a.name.givenName,l=a.name.familyName,r=a.birthday,d=0;d<a.emails.length;d++)"account"===a.emails[d].type&&(n=a.emails[d].value);var v=a.url,m="",u=s(a.image.url),p=e("#securitySignin").val(),_=services_vars.admin_url+"admin-ajax.php";console.log(a),e.ajax({type:"POST",dataType:"json",url:_,data:{action:"conikal_google_signin",userid:i,signin_user:t,full_name:o,first_name:c,last_name:l,email:n,birthday:r,gender:"male",url:v,cover:m,avatar:u,security:p},success:function(a){if(e("#googleSigninBtn").removeClass("loading disabled"),a.signedin===!0){var s='<div class="ui success message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>";e("#signinMessage").empty().append(s),document.location.href=services_vars.signin_redirect}else{var s='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+a.message+"</div>";e("#signinMessage").empty().append(s)}},error:function(e){}})}function _(){FB.getLoginStatus(function(e){"connected"===e.status?g():"not_authorized"===e.status?FB.login(function(e){e.authResponse&&g()},{scope:"publish_actions"}):FB.login(function(e){e.authResponse&&g()},{scope:"publish_actions"})})}function g(){var a=e(".sign-comment").val();""==a&&(a=e(".fb-message-share").val());var s=window.location.href;FB.api("/me/feed","POST",{message:a,link:s},function(a){a&&!a.error?(e(".postFB").removeClass("disabled loading"),e(".postFB").children("i").removeClass("facebook").addClass("checkmark")):e(".postFB").removeClass("disabled loading")})}function h(){var e=window.location.href;FB.ui({method:"share",mobile_iframe:!0,href:e},function(e){callback(e)})}function f(){var e=window.location.href;FB.ui({method:"send",link:e},function(e){callback(e)})}function y(a){if(e("#isDesc").length>0){var s,i=a;tinyMCE.triggerSave();var t=tinyMCE.get(i),n=jQuery("textarea#"+i);return s=n.length>0&&n.is(":visible")?n.val():t.getContent()}return""}function b(){var a="";e('input[name="new_receiver[]"]').each(function(s){a+=e(this).val()+","});var s="";e('input[name="new_position[]"]').each(function(a){s+=e(this).val()+","});var i="";e('input[name="new_decisionmakers[]"]').each(function(a){i+=e(this).val()+","});var t=e("#new_topics").val(),n=services_vars.admin_url+"admin-ajax.php",o=e("#securitySubmitPetition").val();e("#finish-btn").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:n,data:{action:"conikal_save_petition",new_id:e("#new_id").val(),user:e("#current_user").val(),title:e("#new_title").val(),content:y("new_content"),category:e("#new_category").val(),topics:t,city:e("#new_city").val(),lat:e("#new_lat").val(),lng:e("#new_lng").val(),address:e("#new_address").val(),neighborhood:e("#new_neighborhood").val(),state:e("#new_state").val(),country:e("#new_country").val(),zip:e("#new_zip").val(),receiver:a,position:s,decisionmakers:i,goal:e("#new_goal_d").val(),video:e("#new_video").val(),thumb:e("#new_thumb").val(),gallery:e("#new_gallery").val(),attach:e("#new_attach").val(),status:e("#new_status").val(),sendinblue_list:e("#sendinblue_list").val(),security:o},success:function(a){var s="";console.log(a),e("#finish-btn").removeClass("loading disabled"),a.save===!0?(s='<div class="ui success message"><i class="close icon"></i><i class="check circle large icon"></i>'+a.message+"</div>",e("#save-response").empty().append(s),document.location.href=a.propLink):(s='<div class="ui error message"><i class="close icon"></i><i class="warning circle large icon"></i>'+a.message+"</div>",e("#save-response").empty().append(s)),e("#save_response").html(s),e("html,body").animate({scrollTop:0},300)},error:function(e){}})}function w(){var a="";e('input[name="amount_level[]"]').each(function(s){a+=e(this).val()+","});var s="";e('input[name="name_level[]"]').each(function(a){s+=e(this).val()+","});var i="disabled";e("#goal_option").checkbox("is checked")&&(i="enabled");var t="";e("#draft_status").checkbox("is checked")&&(t="draft");var n=services_vars.admin_url+"admin-ajax.php",o=e("#securitySubmitContribute").val();e("#submit-contribute").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:n,data:{action:"conikal_give_save_form",user_id:services_vars.user_id,form_id:e("#form_id").val(),petition_id:e("#petition_id").val(),title:e("#petition_title").val(),goal_option:i,draft_status:t,set_goal:e("#set_goal").val(),goal_format:e("#goal_format").val(),button_label:e("#button_label").val(),close_form_when_goal_achieved:e("#close_form_when_goal_achieved").val(),goal_achieved_message:e("#goal_achieved_message").val(),amount_level:a,name_level:s,custom_amount_minimum:e("#custom_amount_minimum").val(),form_content:e("#form_content").val(),security:o},success:function(a){var s="";console.log(a),e("#submit-contribute").removeClass("loading disabled"),a.save===!0?(s='<div class="ui success message"><i class="close icon"></i><i class="check circle large icon"></i>'+a.message+"</div>",e("#save-response").empty().append(s),"publish"==a.status&&(document.location.href=a.link)):(s='<div class="ui error message"><i class="close icon"></i><i class="warning circle large icon"></i>'+a.message+"</div>",e("#save-response").empty().append(s)),e("#save_response").html(s),e("html,body").animate({scrollTop:0},300)},error:function(e){}})}function k(a,s){var i=services_vars.admin_url+"admin-ajax.php",t=e("#securityDashboard").val();e("#approve-goal").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:i,data:{action:"conikal_set_goal",post_id:a,goal:s,security:t},success:function(a){e("#approve-goal").removeClass("loading disabled"),document.location.href=a.link},error:function(e){}})}function C(a,s,i){var t=services_vars.admin_url+"admin-ajax.php",n=e("#securityDashboard").val();e(a).addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:t,data:{action:"conikal_status_petition",post_id:s,status:i,security:n},success:function(s){e(a).removeClass("loading disabled"),document.location.href=s.link},error:function(e){}})}function x(){var a=services_vars.admin_url+"admin-ajax.php",s=e("#securityUpdate").val();e("#submitUpdate").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:a,data:{action:"conikal_add_update_petition",user_id:services_vars.user_id,post_id:services_vars.post_id,update_id:e("#update_id").val(),status:e("#status").val(),title:e("#update_title").val(),content:y("update_content"),type:e("#update_type").val(),media:e("#update_media").val(),petition_id:e("#petition_id").val(),gallery:e("#new_gallery").val(),video:e("#new_video").val(),thumb:e("#new_thumb").val(),attach:e("#new_attach").val(),security:s},success:function(a){var s="";e("#submitUpdate").removeClass("loading disabled"),a.status===!0?(s='<div class="ui success message"><i class="close icon"></i><i class="check circle large icon"></i>'+a.message+"</div>",document.location.href=a.link):s='<div class="ui error message"><i class="close icon"></i><i class="check circle large icon"></i>'+a.message+"</div>",e("#update-response").empty().append(s),e("html,body").animate({crollTop:0},300)},error:function(e){}})}function j(a){var s=services_vars.admin_url+"admin-ajax.php",i=e("#securityUpdate").val();e.ajax({type:"POST",dataType:"json",url:s,data:{action:"conikal_delete_update",update_id:a,security:i},success:function(s){1==s.delete&&e("#update-"+a).fadeOut(300)}})}function S(a){var s=services_vars.admin_url+"admin-ajax.php",i=e("#securityUpdate").val();e("#updates-more").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:s,data:{action:"conikal_load_updates_petition",user_id:services_vars.user_id,post_id:services_vars.post_id,offset:a,security:i},success:function(s){if(e("#updates-more").removeClass("loading disabled"),1==s.status){var i="";e.each(s.updates,function(e,a){i+='<div class="ui fluid card" id="update-'+a.id+'"><div class="content"><div class="right floated meta"><div class="ui icon top right pointing dropdown edit-update"><i class="angle down icon"></i><div class="menu"><a href="'+a.edit_link+'" class="item" data-bjax>'+services_vars.edit+'</a><a href="javascript:void(0)" class="item delete-update" data-id="'+a.id+'">'+services_vars.delete+'</a></div></div></div><div class="header"><a href="'+a.link+'" data-bjax>'+a.title+'</a></div><div class="description"><div class="ui grid"><div class="sixteen wide mobile sixteen tablet thirteen wide computer column update-excertp">'+a.excerpt+'</div><div class="three wide column computer only"><a href="'+a.link+'" data-bjax><img class="ui fluid image" id="thumbnail-post" src="'+a.thumbnail+'"></a></div></div></div></div><div class="extra content">',a.comment>0&&(i+='<span><i class="comments icon"></i>'+a.comment+" ".services_vars.comments+"</span>"),i+='<span class="right floated">'+a.date+"</span></div></div>"}),e("#update-list").append(i),e("#updates-more").attr("data-offset",parseInt(a)+parseInt(s.per_page)),parseInt(s.updates.length)<parseInt(s.per_page)&&e("#updates-more").css("display","none"),e(".edit-update").dropdown()}else e("#updates-more").css("display","none")},error:function(e){}})}function T(a){var s=e("#petition_id").val();""==s&&(s=services_vars.post_id);var i=e(".sign-comment").val();if(e(".email-notice").hasClass("checked"))var t=!0;else var t=!1;var n=services_vars.admin_url+"admin-ajax.php",o=e("#securitySign").val();e(a).addClass("loading disabled"),e(a).hasClass("signPetition")?e.ajax({type:"POST",dataType:"json",url:n,data:{action:"conikal_add_to_signatures",user_id:services_vars.user_id,post_id:s,reason:i,notice:t,security:o},success:function(s){e(a).removeClass("loading disabled"),s.addsign===!0&&(e(".fav_no").html(s.signature),e(".ned_no").html(s.need),""!=services_vars.unsign?e(a).removeClass("signPetition"):e(a).removeClass("signPetition").addClass("signedPetition"),e(a).children("i").removeClass("write").addClass("checkmark"),e(".petition-goal").progress("increment").attr("data-value",parseInt(s.number)),"refresh"==services_vars.action_after_sign?document.location.href=window.location.href:"redirect"==services_vars.action_after_sign?document.location.href=e("#sign-successful-url").val():"modal"==services_vars.action_after_sign&&e("#sign-successful-modal").modal("show"))},error:function(e){}}):e(a).hasClass("signedPetition")?e.ajax({type:"POST",dataType:"json",url:n,data:{action:"conikal_remove_from_signatures",user_id:services_vars.user_id,post_id:s,security:o},success:function(s){e(a).removeClass("loading disabled"),s.removesign===!0&&(e(".fav_no").html(s.signature),e(".ned_no").html(s.need),e(a).removeClass("signedPetition").addClass("signPetition"),e(a).children("i").removeClass("checkmark").addClass("write"),e(".petition-goal").progress("increment").attr("data-value",parseInt(s.number)))},error:function(e){}}):e(a).removeClass("loading disabled")}function I(a){var s=services_vars.post_id,i=services_vars.user_id,t=services_vars.admin_url+"admin-ajax.php",n=e("#securityBookmark").val();e(a).hasClass("bookmarkPetition")?(e(a).removeClass("bookmarkPetition").addClass("bookmarkedPetition"),e(a).children("i").removeClass("remove bookmark").addClass("bookmark"),e.ajax({type:"POST",dataType:"json",url:t,data:{action:"conikal_add_to_bookmarks",user_id:i,post_id:s,security:n},success:function(e){}})):e(a).hasClass("bookmarkedPetition")&&(e(a).removeClass("bookmarkedPetition").addClass("bookmarkPetition"),e(a).children("i").removeClass("bookmark").addClass("remove bookmark"),e.ajax({type:"POST",dataType:"json",url:t,data:{action:"conikal_remove_from_bookmarks",user_id:i,post_id:s,security:n},success:function(e){}}))}function P(a,s){var i=services_vars.admin_url+"admin-ajax.php",t=e("#securityFollow").val();"follow"==s?e.post(i,{action:"conikal_follow_user",user_id:services_vars.user_id,follow_id:a,type:"follow",security:t}):"unfollow"==s&&e.post(i,{action:"conikal_follow_user",user_id:services_vars.user_id,follow_id:a,type:"unfollow",security:t})}function D(a,s){var i=services_vars.admin_url+"admin-ajax.php",t=e("#securityFollow").val();"follow"==s?e.post(i,{action:"conikal_follow_topic",user_id:services_vars.user_id,topic_id:a,type:"follow",security:t}):"unfollow"==s&&e.post(i,{action:"conikal_follow_topic",user_id:services_vars.user_id,topic_id:a,type:"unfollow",security:t})}function B(a,s,i,t){if(e(a).val().length>0){var n=services_vars.admin_url+"admin-ajax.php",o=e("#securityComment").val(),c=e(a).val();i||(i=0);var l=e("#comment-count").text();e(s).addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:n,data:{action:"conikal_add_comments",user_id:services_vars.user_id,post_id:services_vars.post_id,content:c,parent:i,security:o},success:function(i){if(e(s).removeClass("loading disabled"),e(a).val(""),1==i.save){var t='<div class="comment" id="comment-'+i.details.comment_ID+'"><a class="avatar"><img class="ui bordered image" src="'+i.details.comment_author_avatar+'"></a><div class="content"><a class="author">'+i.details.comment_author_name+'</a><div class="metadata"><div class="date">'+i.time+'</div><div class="date"> · </div><div class="rating"><span id="vote-num-'+i.details.comment_ID+'">0</span> '+services_vars.comment_vote+'</div></div><div class="text">'+i.details.comment_content+'</div><div class="actions"><a href="javascript:void(0)" class="vote up" id="vote-'+i.details.comment_ID+'" data-author="'+i.details.comment_author_name+'" data-id="'+i.details.comment_ID+'"><i class="thumbs up icon"></i>'+services_vars.comment_up_vote+'</a><a href="javascript:void(0)" class="reply" id="comment-reply" data-author="'+i.details.comment_author_name+'" data-id="'+i.details.comment_ID+'"><i class="reply icon"></i>'+services_vars.comment_reply+'</a><a href="javascript:void(0)" class="edit" id="edit-'+i.details.comment_ID+'" data-author="'+i.details.comment_author_name+'" data-id="'+i.details.comment_ID+'"><i class="pencil icon"></i>'+services_vars.edit+'</a><a href="javascript:void(0)" class="delete" id="delete-'+i.details.comment_ID+'" data-author="'+i.details.comment_author_name+'" data-id="'+i.details.comment_ID+'"><i class="delete icon"></i>'+services_vars.delete+"</a></div></div>";0==i.details.comment_parent&&(t+='<div class="comments" id="replies-'+i.details.comment_ID+'"></div>'),t+="</div>",0==i.details.comment_parent?e("#comments-list").append(t):e("#replies-"+i.details.comment_parent).append(t),e("#comment-count").text(parseInt(l)+1),e("#no-comment").empty(),e("#content-comment").attr("placeholder",services_vars.comment_placeholder).css("height","40px"),e("#comment-parent").val("")}else{e(s).removeClass("loading disabled");var n='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+i.message+"</div>";e("#commentMessage").empty().append(n)}},error:function(){e(s).removeClass("loading disabled")}})}else 0==t&&e("#field-comment").addClass("error")}function O(a,s){var i=services_vars.admin_url+"admin-ajax.php",t=e("#securityComment").val(),n=e("#vote-num-"+a).text();"up"==s?(n=parseInt(n)+1,e("#vote-num-"+a).text(n),e("#vote-"+a).removeClass("up").addClass("down").html('<i class="thumbs down icon"></i>'+services_vars.comment_down_vote)):"down"==s&&(n=parseInt(n)-1,e("#vote-num-"+a).text(n),e("#vote-"+a).removeClass("down").addClass("up").html('<i class="thumbs up icon"></i>'+services_vars.comment_up_vote)),e.ajax({type:"POST",dataType:"json",url:i,data:{action:"conikal_vote_comment",user_id:services_vars.user_id,post_id:services_vars.post_id,comment_id:a,type:s,security:t},success:function(e){1==e.status},error:function(){}})}function U(a){var s=services_vars.admin_url+"admin-ajax.php",i=e("#securityComment").val(),t=e("#comment-editor-"+a).val();e("#comment-edit-submit-"+a).addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:s,data:{action:"conikal_update_comment",user_id:services_vars.user_id,post_id:services_vars.post_id,comment_id:a,content:t,security:i},success:function(s){if(e("#comment-edit-submit-"+a).removeClass("loading disabled"),1==s.status)e("#comment-content-"+a).html(s.content);else{var i='<div class="ui small error message"><i class="close icon"></i><i class="warning circle icon"></i>'+s.message+"</div>";e("#comment-edit-message-"+a).html(i)}},error:function(){}})}function F(a){var s=services_vars.admin_url+"admin-ajax.php",i=e("#securityComment").val(),t=e("#comment-count").text();e.ajax({type:"POST",dataType:"json",url:s,data:{action:"conikal_delete_comment",user_id:services_vars.user_id,post_id:services_vars.post_id,comment_id:a,security:i},success:function(a){1==a.status&&(e("#comment-"+a.id).fadeOut(200),e("#comment-count").text(parseInt(t)-1))}})}function M(a,s){var i=services_vars.admin_url+"admin-ajax.php",t=(e("#comment-number").val(),e("#reply-number").val());if(0==a){e("#comment-more").addClass("loading disabled");var s=e("#comment-offset").val()}else var s=0;e.ajax({type:"POST",dataType:"json",url:i,data:{action:"conikal_load_comments",user_id:services_vars.user_id,post_id:services_vars.post_id,parent_id:a,offset:s},success:function(i){if(e("#comment-more").removeClass("loading disabled"),1==i.status){var n="";e.each(i.comments,function(s,o){n+='<div class="comment" id="comment-'+o.comment_ID+'"><a href="'+o.comment_author_link+'" class="avatar" data-bjax><img class="ui bordered image" src="'+o.comment_author_avatar+'"></a><div class="content"><a href="'+o.comment_author_link+'" class="author" data-bjax>'+o.comment_author_name+'</a><div class="metadata"><div class="date">'+o.comment_time+'</div><div class="date"> · </div><div class="rating"><span id="vote-num-'+o.comment_ID+'">'+o.comment_vote+"</span> "+services_vars.comment_vote+'</div></div><div class="text" id="comment-content-'+o.comment_ID+'"><p>'+o.comment_content+'</p></div><div class="actions">',n+=1==o.comment_voted?'<a href="javascript:void(0)" class="vote down" id="vote-'+o.comment_ID+'" data-author="'+o.comment_author_name+'" data-id="'+o.comment_ID+'"><i class="thumbs up icon"></i>'+services_vars.comment_down_vote+"</a>":'<a href="javascript:void(0)" class="vote up" id="vote-'+o.comment_ID+'" data-author="'+o.comment_author_name+'" data-id="'+o.comment_ID+'"><i class="thumbs up icon"></i>'+services_vars.comment_up_vote+"</a>",n+='<a href="javascript:void(0)" class="reply" id="reply-'+o.comment_ID+'" data-author="'+o.comment_author_name+'" data-id="'+o.comment_ID+'"><i class="reply icon"></i>'+services_vars.comment_reply+"</a>",services_vars.user_id!=o.user_id&&1!=services_vars.administrator||(n+='<a href="javascript:void(0)" class="edit" id="edit-'+o.comment_ID+'" data-author="'+o.comment_author_name+'" data-id="'+o.comment_ID+'"><i class="pencil icon"></i>'+services_vars.edit+"</a>",n+='<a href="javascript:void(0)" class="delete" id="delete-'+o.comment_ID+'" data-author="'+o.comment_author_name+'" data-id="'+o.comment_ID+'"><i class="delete icon"></i>'+services_vars.delete+"</a>"),n+="</div></div>",0==a&&(n+='<div class="comments">'),o.replies_total>parseInt(t)&&(n+='<a href="javascript:void(0)" class="hide-replies" id="hide-'+o.comment_ID+'" data-id="'+o.comment_ID+'" style="display: none;"><i class="angle up icon"></i>'+services_vars.comment_replies_hide+"</a>",n+='<a href="javascript:void(0)" class="more-replies" id="more-'+o.comment_ID+'" data-id="'+o.comment_ID+'"><i class="angle down icon"></i>'+services_vars.comment_view_all+" "+(parseInt(o.replies.length)+parseInt(i.per_comment))+" "+services_vars.comment_replies+"</a>",n+='<div class="ui active mini inline loader" id="loading-'+o.comment_ID+'" style="display: none"></div>'),n+='<div id="replies-'+o.comment_ID+'">',o.replies&&e.each(o.replies,function(e,a){n+='<div class="comment" id="comment-'+a.comment_ID+'"><a href="'+a.comment_author_link+'" class="avatar" data-bjax><img class="ui bordered image" src="'+a.comment_author_avatar+'"></a><div class="content"><a href="'+a.comment_author_link+'" class="author" data-bjax>'+a.comment_author_name+'</a><div class="metadata"><div class="date">'+a.comment_time+'</div><div class="date"> · </div><div class="rating"><span id="vote-num-'+a.comment_ID+'">'+a.comment_vote+"</span> "+services_vars.comment_vote+'</div></div><div class="text" id="comment-content-'+a.comment_ID+'"><p>'+a.comment_content+'</p></div><div class="actions">',n+=1==a.comment_voted?'<a href="javascript:void(0)" class="vote down" id="vote-'+a.comment_ID+'" data-author="'+a.comment_author_name+'" data-id="'+a.comment_ID+'"><i class="thumbs up icon"></i>'+services_vars.comment_down_vote+"</a>":'<a href="javascript:void(0)" class="vote up" id="vote-'+a.comment_ID+'" data-author="'+a.comment_author_name+'" data-id="'+a.comment_ID+'"><i class="thumbs up icon"></i>'+services_vars.comment_up_vote+"</a>",n+='<a href="javascript:void(0)" class="reply" id="reply-'+o.comment_ID+'" data-author="'+a.comment_author_name+'" data-id="'+o.comment_ID+'"><i class="reply icon"></i>'+services_vars.comment_reply+"</a>",services_vars.user_id!=a.user_id&&1!=services_vars.administrator||(n+='<a href="javascript:void(0)" class="edit" id="edit-'+a.comment_ID+'" data-author="'+a.comment_author_name+'" data-id="'+a.comment_ID+'"><i class="pencil icon"></i>'+services_vars.edit+"</a>",n+='<a href="javascript:void(0)" class="delete" id="delete-'+a.comment_ID+'" data-author="'+a.comment_author_name+'" data-id="'+a.comment_ID+'"><i class="delete icon"></i>'+services_vars.delete+"</a>"),n+="</div></div></div>"}),n+="</div>",0==a&&(n+="</div>"),n+="</div>"}),0==a?(e("#comments-list").prepend(n),e("#comment-offset").val(parseInt(s)+parseInt(i.per_page))):(e("#hide-"+a).css("display","block"),e("#more-"+a).css("display","none"),e("#loading-"+a).css("display","none"),e("#replies-"+a).html(n))}else e("#comment-more").removeClass("loading disabled").css("display","none");i.comments.length<e("#comment-number").val()&&0==a&&e("#comment-more").css("display","none")},error:function(){e("#comment-more").removeClass("loading disabled")}})}function R(a,s){var i=services_vars.admin_url+"admin-ajax.php",t=e("#securityPetitions").val(),n=e(a).attr("data-number"),o=e(a).attr("data-type"),c=e(a).attr("data-author"),l=e(a).attr("data-page");e(a).addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:i,data:{action:o,user_id:services_vars.user_id,author_id:c,paged:l,security:t},success:function(i){if(e(a).removeClass("loading disabled"),1==i.status){var t="";e.each(i.petitions,function(e,a){t+='<div class="ui segments petition-list-card"><div class="ui segment">',(parseInt(a.sign)>=parseInt(a.goal)||"1"==a.status)&&(t+='<div class="ui primary right corner large label victory-label">'+services_vars.victory_icon+"</div>"),t+='<div class="ui grid"><div class="sixteen wide mobile ten wide tablet ten wide computer column"><div class="petition-content"><div class="ui grid"><div class="sixteen wide column"><div class="ui header list-petition-title"><div class="content"><div class="sub header truncate"><i class="send icon"></i>'+services_vars.petition_to+" "+a.receiver+'</div><a href="'+a.link+'" data-bjax>'+a.title+'</a></div></div></div><div class="sixteen wide column tablet computer only" style="padding-top: 0; padding-bottom: 0;"><div class="text grey">'+a.excerpt+'</div></div></div></div><div class="ui grid"><div class="petition-footer"><div class="sixteen wide column"><span class="text grey place"><i class="marker icon"></i>'+(a.city?a.city+", ":"")+(a.state?a.state+", ":"")+(a.country?a.country:"")+'</span><div class="ui tiny indicating primary progress petition-goal" id="petition-goal" data-value="'+a.sign+'" data-total="'+("1"==a.status?a.sign:a.goal)+'"><div class="bar"><div class="progress"></div></div></div></div></div></div></div><div class="sixteen wide mobile six wide tablet six wide computer column"><a class="ui fluid image" href="'+a.link+'" target="_blank" data-bjax><div class="ui dimmer"><div class="content"><div class="center"><div class="ui icon inverted circular large button"><i class="external icon"></i></div></div>',
""!=services_vars.view_counter&&(t+='<div class="view-counter"><i class="eye icon"></i>'+a.view+"</div>"),t+='</div></div><img class="ui fluid image" id="thumbnail-post" src="'+a.thumbnail+'"></a></div></div></div><div class="ui segment" style="border-top-color: rgba(0,0,0,.05);"><div class="ui grid"><div class="ten wide tablet ten wide computer column tablet computer only"><span class="ui primary label">'+services_vars.supporter_icon+a.sign_fomated+" "+services_vars.supporters+'</span> <span class="ui label"><i class="comments icon"></i>'+a.comments_fomated+" "+services_vars.comments+"</span> ",a.category_name&&(t+='<a class="ui label" href="'+a.category_link+'" data-bjax><i class="tag icon"></i>'+a.category_name+"</a>"),t+='</div><div class="six wide tablet six wide computer right aligned column tablet computer only"><a href="'+a.author_link+'" data-bjax><strong>'+a.author_name+'</strong> <img class="ui avatar bordered image" src="'+a.author_avatar+'" /></a></div><div class="thirteen wide column mobile only"><span class="ui primary label">'+services_vars.supporter_icon+a.sign_compact+" "+services_vars.supporters+'</span><span class="ui label"><i class="comments icon"></i>'+a.comments_fomated+'</span> </div><div class="three wide right aligned column mobile only"><a href="'+a.author_link+'" data-bjax><img class="ui avatar bordered image" src="'+a.author_avatar+'" /></a></div></div></div></div>'}),e(a).attr("data-page",parseInt(l)+1),e(a).attr("data-number",parseInt(n)+i.found_posts),e(s).append(t),(i.found_posts<i.per_page||n+i.found_posts==i.total)&&e(a).css("display","none"),e(".petition-goal").progress({label:!1})}else e(a).removeClass("loading disabled").css("display","none")},error:function(){}})}function L(a){var s=services_vars.admin_url+"admin-ajax.php",i=e("#securityPosts").val(),t=parseInt(e("#post-number").text()),n=e(a).attr("data-type"),o=e(a).attr("data-page");e(a).addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:s,data:{action:n,user_id:services_vars.user_id,paged:o,security:i},success:function(s){if(e(a).removeClass("loading disabled"),1==s.status){var i="";e.each(s.posts,function(e,a){i+='<div class="card blogs post petition-card"><a href="'+a.link+'" class="image" data-bjax><div class="ui dimmer"><div class="content"><div class="center"><div class="ui icon inverted circular large button"><i class="external icon"></i></div></div><div class="view-counter"><i class="comments icon"></i>'+a.comments,""!=services_vars.view_counter&&(i+='<i class="eye icon"></i>'+a.view),i+='</div></div></div><img class="ui fluid image" src="'+a.thumbnail+'"></a><div class="content"><a class="ui tiny label" href="'+a.category_link+'" data-bjax>'+a.category_name+'</a><div class="header card-post-title"><a href="'+a.link+'" data-bjax>'+a.title+'</a></div><div class="description"><div class="text grey">'+a.excerpt+'</div></div></div><div class="extra content">',a.comments&&(i+='<span class="right floated"><a href="'+a.author_link+'" data-bjax>'+a.author_name+"</a></span>"),i+='<span><i class="calendar outline icon"></i>'+a.date+"</span></div></div>"}),e(a).attr("data-page",parseInt(o)+1),e("#post-number").text(t+s.found_posts),e("#content").append(i),(s.found_posts<s.per_page||t+s.found_posts==s.total)&&e(a).css("display","none")}else e(a).removeClass("loading disabled").css("display","none")},error:function(){}})}function z(){var a=services_vars.admin_url+"admin-ajax.php",s=e("#securitySearch").val(),i="",t="",n="",o="",c="",l=e("#search_country option:selected").val();e('input[name="search_topics[]"]').each(function(a){i+=e(this).val()+","}),e('input[name="search_category[]"]:checked').each(function(a){t+=e(this).val()+","}),e('input[name="search_neighborhood[]"]:checked').each(function(a){n+=e(this).val()+","}),e('input[name="search_city[]"]:checked').each(function(a){o+=e(this).val()+","}),e('input[name="search_state[]"]:checked').each(function(a){c+=e(this).val()+","}),e.ajax({type:"POST",dataType:"json",url:a,data:{action:"conikal_load_search_petitions",search_keyword:e(".search-keywords").text(),search_topics:i,search_category:t,search_neighborhood:n,search_city:o,search_state:c,search_country:l,security:s},success:function(a){var s="";e.each(a.petitions,function(e,a){s+='<div class="item">',s+='<div class="image">',(parseInt(a.sign)>=parseInt(a.goal)||"1"==a.status)&&(s+='<div class="ui primary left corner label victory-label"> '+services_vars.victory_icon+"</div>"),s+='<a href="'+a.link+'" data-bjax><img class="ui fluid image" src="'+a.thumbnail+'" /></a></div><div class="content"><a class="header list-petition-title" href="'+a.link+'" data-bjax>'+a.title+'</a><div class="meta"><span class="receiver"><i class="send icon"></i> '+services_vars.petition_to+" "+a.receiver+'</span></div><div class="description"><div class="text grey">'+a.excerpt+'</div></div><div class="extra">',s+="false"==services_vars.is_mobile?'<div class="ui right floated tiny header"><a href="'+a.author_link+'" data-bjax><strong>'+a.author_name+'</strong> <img class="ui avatar bordered image" src="'+a.author_avatar+'" /></a></div><div class="ui primary label">'+services_vars.supporter_icon+a.sign+" "+services_vars.supporters+'</div> <div class="ui label"><i class="comments icon"></i>'+a.comments+" "+services_vars.comments+"</div> ":'<div class="ui right floated tiny header"><a href="'+a.author_link+'" data-bjax><img class="ui avatar bordered image" src="'+a.author_avatar+'" /></a></div><div class="ui primary label">'+services_vars.supporter_icon+a.sign+" "+services_vars.supporters+'</div> <div class="ui label"><i class="comments icon"></i>'+a.comments+"</div>",a.category_name&&"false"==services_vars.is_mobile&&(s+='<a class="ui label" href="'+a.category_link+'" data-bjax><i class="tag icon"></i>'+a.category_name+"</a>"),s+="</div></div></div>"}),e(".results-number").text(a.total),e("#search-results").html(s),e("html,body").animate({crollTop:0},300)},error:function(e){}})}function q(a){var s={types:["(regions)"],language:["en"]};if(e("#address"+a).length>0){var i=document.getElementById("address"+a),t=new google.maps.places.Autocomplete(i,s);google.maps.event.addListener(t,"place_changed",function(){var s=t.getPlace();e("#address"+a).blur();for(var i=s.geometry.location.lat,n=s.geometry.location.lng,o=0;o<s.address_components.length;o++){var c=s.address_components[o].types[0],l=s.address_components[o].short_name;"administrative_area_level_1"===c?e("#state"+a).val(l):"administrative_area_level_2"===c?e("#city"+a).val(l):"locality"===c?e("#city"+a).val(l):"sublocality"===c?e("#neighborhood"+a).val(l):"neighborhood"===c?e("#neighborhood"+a).val(l):"sublocality_level_1"===c?e("#neighborhood"+a).val(l):"country"===c?e("#country"+a).val(l):"postal_code"===c&&e("#zip"+a).val(l)}return e("#lat"+a).val(i),e("#lng"+a).val(n),!1})}e("#address"+a).keydown(function(){e(this).val().length<=1&&(e("#country"+a).val(""),e("#state"+a).val(""),e("#city"+a).val(""),e("#neighborhood"+a).val(""),e("#zip"+a).val(""),e("#lat"+a).val(""),e("#lng"+a).val(""))})}e(".submitSign").click(function(){i()}),e("#usernameSign, #firstnameSign, #lastnameSign, #emailSign, #passSign").keydown(function(e){13===e.keyCode&&(e.preventDefault(),i())}),e("#submitSignup").click(function(){t()}),e("#usernameSignup, #firstnameSignup, #lastnameSignup, #emailSignup, #passSignup").keydown(function(e){13===e.keyCode&&(e.preventDefault(),t())}),e("#submitSignin").click(function(){n()}),e("#usernameSignin, #passwordSignin").keydown(function(e){13===e.keyCode&&(e.preventDefault(),n())}),e("#submitForgot").click(function(){o()}),e("#emailForgot").keydown(function(e){13===e.keyCode&&(e.preventDefault(),o())}),a("action")&&"rp"==a("action")&&setTimeout(function(){e("#resetpass").modal("show"),e("#resetKey").val(a("key")).parent().addClass("disabled")},3e3),e("#submitResetPass").click(function(){c()}),e("#resetKey, #resetPass_1, #resetPass_2").keydown(function(e){13===e.keyCode&&(e.preventDefault(),c())}),e("#fbLoginBtn").on("click",function(){e(".signinFBText").addClass("loading disabled"),l()}),e("#googleSigninBtn").click(function(){e("#googleSigninBtn").addClass("disabled loading");var a={callback:m,scope:"profile email"};gapi.auth.signIn(a)}),e(".share-facebook").on("click",function(){h()}),e(".send-message").on("click",function(){f()}),e(".fb-publish").click(function(){var a=services_vars.admin_url+"admin-ajax.php",s=e("#securitySign").val();if(e(".fb-publish").hasClass("checked"))var i=!1;else var i=!0;e.ajax({type:"POST",dataType:"json",url:a,data:{action:"conikal_facebook_publish",user_id:services_vars.user_id,publish:i,security:s},success:function(e){},error:function(e){}})}),e(".email-notice").click(function(){var a=services_vars.admin_url+"admin-ajax.php",s=e("#securitySign").val();if(e(".email-notice").hasClass("checked"))var i=!1;else var i=!0;e.ajax({type:"POST",dataType:"json",url:a,data:{action:"conikal_email_notice",user_id:services_vars.user_id,notice:i,security:s},success:function(e){},error:function(e){}})}),e("#updateProfileBtn").click(function(){var a=services_vars.admin_url+"admin-ajax.php",s=e("#securityUserProfile").val(),i=e('input[name="typeUser"]:checked').val();e("#up_response").empty(),e("#updateProfileBtn").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:a,data:{action:"conikal_update_user_profile",user_id:e("#idUser").val(),type:i,name:e("#nameUser").val(),firstname:e("#firstnameUser").val(),lastname:e("#lastnameUser").val(),gender:e('input[name="genderUser"]:checked').val(),nickname:e("#nicknameUser").val(),email:e("#emailUser").val(),birthday:e("#birthdayUser").val(),address:e("#addressUser").val(),neighborhood:e("#neighborhoodUser").val(),state:e("#stateUser").val(),city:e("#cityUser").val(),country:e("#countryUser").val(),lat:e("#latUser").val(),lng:e("#lngUser").val(),website:e("#websiteUser").val(),bio:e("#bioUser").val(),password:e("#passUser").val(),re_password:e("#repassUser").val(),avatar:e("#new_gallery").val(),avatar_id:e("#new_attach").val(),decision_id:e("#decision_id").val(),decision_title:e("#titleUser").val(),decision_organization:e("#organizationUser").val(),security:s},success:function(a){e("#updateProfileBtn").removeClass("loading disabled");var s="";if(a.save===!0)var s='<div class="ui success message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>";else var s='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+a.message+"</div>";e("#up_response").empty().html(s),e("#decision_id").val(a.decision_id),"petitioner"===i&&e("#decision_status").empty(),e("html,body").animate({scrollTop:0},300)},error:function(e){}})}),e("#finish-btn").click(function(){b()}),e("#submit-contribute").click(function(){w()}),e("#approve-goal").on("click",function(){var a=e(this).attr("data-id"),s=e("#new-goal").val();k(a,s)}),e("#approve-reopen").on("click",function(){var a=e(this).attr("data-id");C("#approve-reopen",a,0)}),e("#approve-close").on("click",function(){var a=e(this).attr("data-id");C("#approve-close",a,2)}),e("#submitUpdate").click(function(){x()}),e(document).on("click","a.delete-update",function(){var a=e(this).attr("data-id");j(a)}),e("#updates-more").on("click",function(){var a=e(this).attr("data-offset");S(a)}),e(".signBtn").click(function(){T(".signBtn"),B(".sign-comment",".signBtn",!0),e(".fb-publish").hasClass("checked")&&e(".signBtn").hasClass("signPetition")&&_()}),e(".postFB").click(function(){e(".postFB").children("i").hasClass("facebook")&&(e(".postFB").addClass("disabled loading"),_())}),e("#bookmarkBtn").click(function(){I("#bookmarkBtn")}),e(document).on("click","a.follow-user",function(){var a=e(this).attr("data-id");e(this).hasClass("follow")?(e(this).removeClass("basic button follow-user follow").addClass("primary button follow-user following").html('<i class="checkmark icon"></i>'),P(a,"follow")):e(this).hasClass("following")&&(e(this).removeClass("primary button follow-user following").addClass("basic button follow-user follow").html('<i class="plus icon"></i>'),P(a,"unfollow"))}),e(document).on("click","a.follow-profile",function(){var a=e(this).attr("data-id");e(this).hasClass("follow")?(e(this).removeClass("inverted button follow-profile follow").addClass("primary button follow-profile following").html('<i class="checkmark icon"></i>'+services_vars.following),P(a,"follow")):e(this).hasClass("following")&&(e(this).removeClass("primary button follow-profile following").addClass("inverted button follow-profile follow").html('<i class="plus icon"></i>'+services_vars.follow),P(a,"unfollow"))}),e(document).on("click","a.follow-page",function(){var a=e(this).attr("data-id");e(this).hasClass("follow")?(e(this).removeClass("basic button follow-page follow").addClass("primary button follow-page following").html('<i class="checkmark icon"></i>'+services_vars.following),P(a,"follow")):e(this).hasClass("following")&&(e(this).removeClass("primary button follow-page following").addClass("basic button follow-page follow").html('<i class="plus icon"></i>'+services_vars.follow),P(a,"unfollow"))}),e(document).on("click","button.follow-topic",function(){var a=e(this).attr("data-id");e(this).hasClass("follow")?(e(this).removeClass("follow-topic follow").addClass("follow-topic following").html(services_vars.following),D(a,"follow")):e(this).hasClass("following")&&(e(this).removeClass("follow-topic following").addClass("follow-topic follow").html(services_vars.follow),D(a,"unfollow"))}),e(document).on("click","a.follow-topic",function(){var a=e(this).attr("data-id");e(this).hasClass("follow")?(e(this).removeClass("inverted button follow-topic follow").addClass("primary button follow-topic following").html('<i class="checkmark icon"></i>'+services_vars.following),D(a,"follow")):e(this).hasClass("following")&&(e(this).removeClass("primary button follow-topic following").addClass("inverted button follow-topic follow").html('<i class="plus icon"></i>'+services_vars.follow),D(a,"unfollow"))}),e("#content-comment").keydown(function(a){if(13==a.keyCode&&!a.shiftKey&&"false"==services_vars.is_mobile){var s=e("#comment-parent").val();B("#content-comment","#submitComment",s,!1),a.preventDefault()}}),e("#send-comment").on("click",function(){var a=e("#comment-parent").val();B("#content-comment","#submitComment",a,!1)}),e("#content-comment").click(function(){e("#field-comment").removeClass("error")}),e(document).on("click","a.vote",function(){var a=e(this).attr("data-id");e(this).hasClass("up")?O(a,"up"):e(this).hasClass("down")&&O(a,"down")}),e(document).on("click","a.comment-edit-submit",function(){var a=e(this).attr("data-id");U(a)}),e(document).on("click","a.delete",function(){var a=e(this).attr("data-id");F(a)}),e("#comment-more").click(function(){M(0)}),e(document).on("click","a.more-replies",function(){var a=e(this).attr("data-id"),s=e(this).attr("data-offset");M(a,s),e("#loading-"+a).css("display","block")}),e(document).on("click","a.hide-replies",function(){var a=e(this).attr("data-id");e("#more-"+a).css("display","block"),e("#hide-"+a).css("display","none"),e("#replies-"+a).html("")}),e(document).on("click","a.reply",function(){var a=e(this).attr("data-id"),s=e(this).attr("data-author");e("#comment-parent").val(a),e("#content-comment").attr("placeholder",services_vars.comment_reply_to+" "+s).focus()}),e("#save-letter").on("click",function(){var a=services_vars.admin_url+"admin-ajax.php",s=e("#textarea-letter").val(),i=e("#securityLetter").val();e("#letter-response").empty(),e("#save-letter").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:a,data:{action:"conikal_update_letter",post_id:services_vars.post_id,letter:s,security:i},success:function(a){e("#save-letter").removeClass("loading disabled");var s="";if(a.save===!0){var s='<div class="ui success message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>";e("#content-letter").html(a.content),e("#save-letter").css("display","none"),e("#edit-letter").css("display","block")}else var s='<div class="ui error message"><i class="close icon"></i><i class="warning circle icon"></i>'+a.message+"</div>";e("#letter-response").empty().html(s).fadeOut(2e3)},error:function(e){}})}),e("#load-more").on("click",function(){R("#load-more","#content")}),e("#load-more").visibility({once:!1,observeChanges:!0,offset:800,onTopVisible:function(){R("#load-more","#content")}}),e("#load-trending").on("click",function(){R("#load-trending","#content-trending")}),e("#load-trending").visibility({once:!1,observeChanges:!0,offset:800,onTopVisible:function(){R("#load-trending","#content-trending")}}),e("#load-recent").on("click",function(){R("#load-recent","#content-recent")}),e("#load-recent").visibility({once:!1,observeChanges:!0,offset:800,onTopVisible:function(){R("#load-recent","#content-recent")}}),e("#load-posts-more").on("click",function(){L("#load-posts-more")}),e("#sendContactMessageBtn").click(function(){var a=services_vars.admin_url+"admin-ajax.php",s=e("#securityContactPage").val();e("#cp_response").empty(),e("#sendContactMessageBtn").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:a,data:{action:"conikal_send_message_to_company",company_email:e("#company_email").val(),name:e("#cp_name").val(),email:e("#cp_email").val(),subject:e("#cp_subject").val(),message:e("#cp_message").val(),security:s},success:function(a){e("#sendContactMessageBtn").removeClass("loading disabled");var s="";a.sent===!0?(s='<div class="ui success message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>",e("#cp_name").val(""),e("#cp_email").val(""),e("#cp_subject").val(""),e("#cp_message").val("")):s='<div class="ui error message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>",e("#cp_response").html(s)},error:function(e){}})}),e("#sendBtn").click(function(){var a=services_vars.admin_url+"admin-ajax.php",s=e("#securityContactUser").val();e("#contact-response").empty(),e("#sendBtn").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:a,data:{action:"conikal_send_message_to_user",user_email:e("#user_email").val(),name:e("#contact_name").val(),email:e("#contact_email").val(),subject:e("#contact_subject").val(),message:e("#contact_message").val(),security:s},success:function(a){e("#sendBtn").removeClass("loading disabled");var s="";a.sent===!0?(s='<div class="ui success message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>",e("#contact_name").val(""),e("#contact_email").val(""),e("#contact_subject").val(""),e("#contact_message").val("")):s='<div class="ui error message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>",e("#contact-response").html(s)},error:function(e){}})}),e("#send-invite").click(function(){var a=services_vars.admin_url+"admin-ajax.php",s=e("#securityInvitation").val();e("#invitation-response").empty(),e("#send-invite").addClass("loading disabled"),e.ajax({type:"POST",dataType:"json",url:a,data:{action:"conikal_send_invatation",user_email:e("#user_email").val(),name:e("#invite_name").val(),email:e("#invite_email").val(),subject:e("#invite_subject").val(),message:e("#invite_message").val()+e("#invite_link").val(),security:s},success:function(a){e("#send-invite").removeClass("loading disabled");var s="";s=a.sent===!0?'<div class="ui success message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>":'<div class="ui error message"><i class="close icon"></i><i class="check circle icon"></i>'+a.message+"</div>",e("#invitation-response").html(s)},error:function(e){}})}),e(document).on("click",".decision-search",function(){e(".decision-search").search({showNoResults:!1,transition:"fade down",minCharacters:services_vars.min_characters,maxResults:services_vars.max_results,apiSettings:{url:services_vars.home_url+"/decision-makers-search/?q={query}"},fields:{results:"results",title:"name",description:"description",image:"avatar"},onSelect:function(a,s){e(this).find(".decision-title").val(a.description),e(this).find(".new_decisionmakers").val(a.author)}}),e(this).find(".decision-title, .prompt").change(function(){var a=e(this).next().val();a&&e(this).next().val("")})});var N=e.parseJSON(services_vars.search_settings),E={results:"results",title:"title"};if("false"==services_vars.is_mobile&&("enabled"==N.conikal_s_link_field&&(E.url="link"),"enabled"==N.conikal_s_description_field&&(E.description="excerpt"),"enabled"==N.conikal_s_image_field&&(E.image="thumbnail"),"enabled"==N.conikal_s_supporters_field&&(E.price="sign_compact")),e(".petitions-search").search({minCharacters:services_vars.min_characters,transition:"fade down",type:services_vars.search_type,apiSettings:{onResponse:function(a){if(e(".search-input").keydown(function(e){13===e.keyCode&&(e.preventDefault(),document.location.href=a.action.url)}),"category"==services_vars.search_type){var s={results:{},action:a.action};e.each(a.results,function(e,a){var i=a.category_name||"Unknown",t=services_vars.max_results;return!(e>=t)&&(void 0===s.results[i]&&(s.results[i]={name:i,results:[]}),void s.results[i].results.push({title:a.title,excerpt:a.excerpt,link:a.link,thumbnail:a.thumbnail,sign_compact:a.sign_compact}))})}else s=a;return s},url:services_vars.home_url+"/petitions-search/?q={query}"},fields:E}),e(".page-search").search({minCharacters:services_vars.min_characters,maxResults:services_vars.max_results,transition:"fade down",apiSettings:{url:services_vars.home_url+"/petitions-search/?q={query}",onResponse:function(a){var s="";e.each(a.results,function(e,a){s+='<div class="item">',s+='<div class="image">',(parseInt(a.sign)>=parseInt(a.goal)||"1"==a.status)&&(s+='<div class="ui primary left corner label victory-label"> '+services_vars.victory_icon+"</div>"),s+='<a href="'+a.link+'" data-bjax><img class="ui fluid image" src="'+a.thumbnail+'" /></a></div><div class="content"><a class="header" href="'+a.link+'" data-bjax>'+a.title+'</a><div class="meta"><span class="receiver"><i class="send icon"></i> '+services_vars.petition_to+" "+a.receiver+'</span></div><div class="description"><div class="text grey">'+a.excerpt+'</div></div><div class="extra">',s+="false"==services_vars.is_mobile?'<div class="ui right floated tiny header"><a href="'+a.author_link+'" data-bjax><strong>'+a.author_name+'</strong> <img class="ui avatar bordered image" src="'+a.author_avatar+'" /></a></div><div class="ui primary label">'+services_vars.supporter_icon+a.sign+" "+services_vars.supporters+'</div> <div class="ui label"><i class="comments icon"></i>'+a.comments+" "+services_vars.comments+"</div> ":'<div class="ui right floated tiny header"><a href="'+a.author_link+'" data-bjax><img class="ui avatar bordered image" src="'+a.author_avatar+'" /></a></div><div class="ui primary label">'+services_vars.supporter_icon+a.sign+" "+services_vars.supporters+'</div> <div class="ui label"><i class="comments icon"></i>'+a.comments+"</div>",a.category_name&&"false"==services_vars.is_mobile&&(s+='<a class="ui label" href="'+a.category_link+'" data-bjax><i class="tag icon"></i>'+a.category_name+"</a>"),s+="</div></div></div>"}),e(".results-number").text(a.total),e("#search-results").html(s),e(".search-input").keydown(function(e){13===e.keyCode&&(e.preventDefault(),document.location.href=a.action.url)})}}}),e('input[name="search_topics[]"], input[name="search_category[]"], input[name="search_neighborhood[]"], input[name="search_city[]"], input[name="search_state[]"], #search_country').change(function(){z()}),e("#reset-filter").on("click",function(){e("#form-filter")[0].reset(),e("#search_country").dropdown("restore defaults"),e("#search_topics").dropdown("restore defaults"),z()}),e("#new_address").length>0){var K={types:["(regions)"],language:["en"]},V=document.getElementById("new_address"),A=new google.maps.places.Autocomplete(V,K);google.maps.event.addListener(A,"place_changed",function(){var a=A.getPlace();e("#new_address").blur();for(var s=a.geometry.location.lat,i=a.geometry.location.lng,t=0;t<a.address_components.length;t++){var n=a.address_components[t].types[0],o=a.address_components[t].short_name;"administrative_area_level_1"===n?e("#new_state").val(o):"administrative_area_level_2"===n?e("#new_city").val(o):"locality"===n?e("#new_city").val(o):"sublocality"===n?e("#new_neighborhood").val(o):"neighborhood"===n?e("#new_neighborhood").val(o):"sublocality_level_1"===n?e("#new_neighborhood").val(o):"country"===n?e("#new_country").val(o):"postal_code"===n&&e("#new_zip").val(o)}return e("#new_lat").val(s),e("#new_lng").val(i),!1})}e("#new_address").keydown(function(){e(this).val().length<=1&&(e("#new_country").val(""),e("#new_state").val(""),e("#new_city").val(""),e("#new_neighborhood").val(""),e("#new_zip").val(""),e("#new_lat").val(""),e("#new_lng").val(""))}),q("Sign"),q("Signup"),q("User")}(jQuery);